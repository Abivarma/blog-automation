<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI News Blog - Archive</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">
            <h1>AI News Blog</h1>
        </div>
        <div class="nav-links">
            <a href="index.html">Dashboard</a>
            <a href="archive.html" class="active">Archive</a>
            <a href="settings.html">Settings</a>
        </div>
        <button class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">
            <span id="theme-icon">&#9790;</span>
        </button>
    </nav>

    <main class="container">
        <section class="card">
            <div class="archive-header">
                <h2>All Posts</h2>
                <div class="archive-filters">
                    <input type="text" id="search-input" placeholder="Search posts..." class="input">
                    <select id="sort-select" class="input" onchange="renderArchive()">
                        <option value="date-desc">Newest first</option>
                        <option value="date-asc">Oldest first</option>
                        <option value="seo-desc">Highest SEO</option>
                        <option value="words-desc">Most words</option>
                    </select>
                </div>
            </div>

            <table class="archive-table" id="archive-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Title</th>
                        <th>Words</th>
                        <th>SEO</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="archive-body">
                    <tr><td colspan="6" class="muted">Loading...</td></tr>
                </tbody>
            </table>
        </section>
    </main>

    <footer>
        <p>AI News Blog Automation &mdash; <a href="https://github.com/Abivarma/blog-automation" target="_blank">GitHub</a></p>
    </footer>

    <script src="js/app.js"></script>
    <script>
        let allPosts = [];

        async function loadArchive() {
            try {
                const resp = await fetch('data/posts.json');
                allPosts = await resp.json();
                renderArchive();
            } catch (e) {
                document.getElementById('archive-body').innerHTML =
                    '<tr><td colspan="6" class="muted">No posts yet. Generate your first blog post!</td></tr>';
            }
        }

        function renderArchive() {
            const search = document.getElementById('search-input').value.toLowerCase();
            const sort = document.getElementById('sort-select').value;

            let filtered = allPosts.filter(p =>
                p.title.toLowerCase().includes(search) ||
                (p.keywords || []).join(' ').toLowerCase().includes(search)
            );

            filtered.sort((a, b) => {
                switch (sort) {
                    case 'date-asc': return a.date.localeCompare(b.date);
                    case 'seo-desc': return b.seo_score - a.seo_score;
                    case 'words-desc': return b.word_count - a.word_count;
                    default: return b.date.localeCompare(a.date);
                }
            });

            const tbody = document.getElementById('archive-body');
            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="muted">No matching posts</td></tr>';
                return;
            }

            tbody.innerHTML = filtered.map(p => `
                <tr>
                    <td>${p.date}</td>
                    <td class="title-cell">${escapeHtml(p.title)}</td>
                    <td>${p.word_count.toLocaleString()}</td>
                    <td><span class="seo-badge ${seoClass(p.seo_score)}">${p.seo_score}</span></td>
                    <td><span class="status-badge status-${p.status}">${p.status}</span></td>
                    <td><a href="post.html?file=${encodeURIComponent(p.filename)}" class="btn btn-sm">Read</a></td>
                </tr>
            `).join('');
        }

        document.getElementById('search-input').addEventListener('input', renderArchive);
        loadArchive();
    </script>
</body>
</html>
